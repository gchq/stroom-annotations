language: java
dist: trusty
group: edge
jdk: oraclejdk8
sudo: required # To ensure we get a VM rather than a container for more memory and for all the apt-get stuff

services:
  - docker

env:
  global:
    # $TAGPERM environment variable
    # generate a token at https://github.com/settings/tokens and encrypt it
    # with `travis encrypt TAGPERM=<yoursecrettoken>`
    # also see: https://docs.travis-ci.com/user/encryption-keys/#Usage
    # and: https://docs.travis-ci.com/user/best-practices-security/
    - secure: icIVmFPty5gWZfCDK72oVa/4kh16zTSPkHOsDhwXLO44n5X+UPiHNq/+S2e0u/tvO4r4BoUA8cAgitXPMhO1LykrIzavrgfCYie7dVf5x357W8f7rp2F7ZvxrFNP743jnrUttSJgFPQ2T1QZ9PeH0tSRJV6cvGxrTu7LoIZfR74iBb0RLRMbL7Z2WMb/p4cdajDFn+n1n0sDnrKX9OvDka/B8c7gRzf48fp2mXwqROMmuAxY6JlRLQqg4tBBURyrBHX6mzVtKddwNNIO7Dkz3hlw/4pgOYSNtLJkbHZEJqfEjetrBNodkdcRPmqRSZs9MIL2G6+o4GeCjNFu6yhHi8PZf4HBqqnY4QuWcRVjQkO07J/pFBFJE31ZxTJ5ze23dzlNEhvn8LjNKh5wJ+8aSJYVKPPCxrGWApMSYyGM8Iv7WVQXLAqPCGaBRjTbWrsDltRvW9uMYg/HV1xJ0oTZmGYVCYcU2HCWw/3v5QobDqc0kK0ysnMgiGFXKOMfFDxxKyEnmnzUlG7zOA64cWt1zB+KhhJuT8sgI15ywwq37JO4HorNzkf64AvX5U9IEJkrzkkQB/oE2DirUx/sdSkSV6fPtHn2GbCL5fI0j9jnSFeOQ64f/zy/FJNvjWVDITdqRoA5XUrC8EdbwFaQdrhwkQrIlTfCtgGuZjUBdmKmVpk=

install: echo "skip 'gradle assemble' step to speed up build"

before_script: ./travis.before_script.sh

# Use 1 local worker to avoid using too much memory as each worker will chew up ~500Mb ram
script: ./travis.script.sh

# Push to GitHub releases for any tagged commit - the key was generated by the Travis CLI: `$ travis setup releases`
deploy:
  provider: releases
  api_key:
    secure: Xv5WGPYWWM24rkmQ0EgLsRW29THsJjzBcTujv4HXDpgeevkF3CDs+avsrv+24OGc+FD9fA0H+N3rKfsXFK9axxIskyVQ0wEgchPiuODpn7o0FZ+AFCiijh79oRVtFzRanEQXS8CVmx6Td6gtQo+7hUacRPA547b1k2tf4uXDFaxIs8WFIaOzgMINjzgP8L9E6m968a4gt/iuPjaCMp03GJsyqt+/lzRFu2wKtiTKw5KYfny9mg/gNXGBcYtrt9nN9SueEmYQP+NKOQHiGLjTWJ8ItGK+8AzDKjDKPirrkBoT40c6XPgZlzWWOMf1rvDNz+10ATEB2cxeQw08CmiKAnP3/f/KgpEmsVIXs5hrvy2Pvgyz6Ndzg0qn5XmhuUtclbdIBTW3CdIWujVbStBTErAvjoUyKhgpthyt8qMkWT5BShXBwnzOoQ+ujscs55Plkzv+fOQKcZgdQikE/8ZEIu2+7p4PAXWZKkVE1kQUyVD3yNlgN3ux5zPnHknHnfyOIRXDZayiWgNefiCB/9KW8OZ6qOnT2Ji+AMBFvL30udcFwD0T8veEIXphYr4CijgZbEVZwWDkOwDnK9EzPO5P9RXzvQP5ilVqLEvxTMggA4NVN2LPl31Qy+lhC4Ya/wtfqAP/jbzxkTI2U12Xo0+VbiYWShsXIHf3KzOMFGjpvl4=
    file: stroom-annotations-svc/build/libs/stroom-annotations-service-all.jar
  skip_cleanup: true
  on:
    repo: gchq/stroom-annotations
    tags: true

# Clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - libs
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

