language: java
dist: trusty
group: edge
jdk: oraclejdk8
sudo: required # To ensure we get a VM rather than a container for more memory and for all the apt-get stuff

env:
  global:
    # $TAGPERM environment variable
    # generate a token at https://github.com/settings/tokens and encrypt it
    # with `travis encrypt TAGPERM=<yoursecrettoken>`
    # also see: https://docs.travis-ci.com/user/encryption-keys/#Usage
    # and: https://docs.travis-ci.com/user/best-practices-security/
    - secure: "p04UfQL9fsTU0jaTqcnjarh+gxsBJGGIXJUTLs1VOQ2jXsl4+ThDnaR+xfNKxeJx7jaLeidiaKF8Ax/kP8w7l79IiTtfPMOVH+oMJkWVKC81fd9M0g+N+0n5b9eXJImWRQppDd8VmFMCJX0XgFMIRSFjWfWNf3NIPKwir7jpdX9n6ZYZcULpOKX567qT8TZKbLsH/atGOWphEKwwlpkYdVBwnACxWcQ395UkbPo+57R5uH5FzDBM7X/TBByVCS7MburDjLlDXGw38YEMKwaFMx0bvuTMb8N1TCONuFHiCROoxzY2lvZNHbRKd2tbXhCA+9lbHtAvPMBFzE9p0LbuTegbxACd3xILteKfIZ52ZCoUQPJwItkCNHHM49l/kLD1Cz4dTjw9RnziqctAk3kvYDQ3dIUlr6GTQXiQ1Td55+77nKI2GcdFtIB5+JdM2W4KbR7e2shFvaoVHXIT9cskf1/F/8VpT8718KB91dm1CMvsrWb1pXgRmjLFNT8lMkKTAgOajHfQFfTI4/hQzQ6W/n+S3zfNzSBW6PccnS3iviqHd+9r/pkXQE6n20Rq8eez2yY2BZwGWgHP9PCVZTaAzr7cot0g8/djLQ2d/AAkqvqtDZQdyKhsTkY1E78pYOmyG6hit5UdSubEliIyONLsYU6DquBIGonznSTSqZhO+FU="
#Don't think we need to manually install docker/compose at it comes built in
before_install:
    #Print out the current versions before we change them
  - echo "Docker Versions"
  - docker --version
  - docker-compose --version

install: echo "skip 'gradle assemble' step to speed up build"

before_script: ./travis.before_script.sh

# Use 1 local worker to avoid using too much memory as each worker will chew up ~500Mb ram
script: ./travis.script.sh

# Push to GitHub releases for any tagged commit - the key was generated by the Travis CLI: `$ travis setup releases`
deploy:
  provider: releases
  api_key:
    secure: J0xazmGXIi8IB6cajKd4AVBtSrmacvsV3RAA3ZJo8XsR/AkmHEDVH+HrCPwsg5kfKQXYX3f5o9KseVJMWGEaHzJyZVJmcPCrwMt5pqcctpUxl5mDQRH3oplaAiFDIe2JQbOrk1axnAeqcyBwxZF84RTDAwrKAoBDeGdaeqNpk/jZZNwfoGVpvYGza2gnhz6k2QbSuQa5Q1FOLxLdBS8pqkfNg4U4whzCzDhZdExh5Hob3gIaavIs0CANBT68ezKrc7wPDGkSvgo2frC7G2Qg7elfUky6PnT0d8p3Qt2q+ATijoBFOE7OP5nap2nI2zasugOuV31q/u4jX/q1ikYB1pOuCqrw+3bsrkklMB9KtCkKSWOaNnG2EAO5KYRlSPE2+CO1N+/YhjxGPOCAWIOsbN3sXjL/ARSliOsioWDxgp7llCxL09fWSV+owFwRTXz3RcmFLJcc1Vj/KdWczbtzvCJjFOiDe0lYZLUqIgaOY79JZ0R+X2co+Faqz0kwi7+6apWtmloGn044NwJf3T3bTI5W4RC/e/R93b8nv8j8469EAe8pLaJMoMmJTOXBxgErUIO4W0rhoMKn8Qj5ig9JvWmS1Pvfn3E/NJ+y4tRFsCM2pocR3FUDDESmEduSzOlxj//u6DyrXziF3aLdlh2Ua7koDSKJHfZN9tplsDp5sc4=
  file: stroom-annotations-svc/build/libs/stroom-annotations-service-all.jar
  skip_cleanup: true
  on:
    repo: gchq/stroom-annotations
    tags: true

# Clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - libs
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

